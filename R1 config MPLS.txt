R1

Router>enable
Router#conf t
Router(config)#hostname R1
R1(config)# interface loopback 0
R1(config-if)#ip address 1.1.1.1 255.255.255.255
R1(config-if)#exit

R1(config)#int e0/0
R1(config-if)#ip address 10.0.0.1 255.255.255.0
R1(config-if)#no shut

R1(config)#router ospf 1
R1(config-router)#network 1.1.1.0 0.0.0.255 area 0
R1(config-router)#network 10.0.0.0 0.0.0.255 area 0
R1(config-router)#exit

R1#show ip route ospf

Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
 D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
 N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
 E1 - OSPF external type 1, E2 - OSPF external type 2
 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
 ia - IS-IS inter area, * - candidate default, U - per-user static route
 o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
 a - application route
 + - replicated route, % - next hop override
Gateway of last resort is not set
 2.0.0.0/32 is subnetted, 1 subnets
O 2.2.2.2 [110/11] via 10.0.0.2, 00:15:40, Ethernet0/0
 3.0.0.0/32 is subnetted, 1 subnets
O 3.3.3.3 [110/21] via 10.0.0.2, 00:04:01, Ethernet0/0
 10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
O 10.0.1.0/24 [110/20] via 10.0.0.2, 00:09:25, Ethernet0/0

R1#sh ip cef

Prefix Next Hop Interface
0.0.0.0/0 no route
0.0.0.0/8 drop
0.0.0.0/32 receive 
1.1.1.1/32 receive Loopback0
2.2.2.2/32 10.0.0.2 Ethernet0/0
3.3.3.3/32 10.0.0.2 Ethernet0/0
10.0.0.0/24 attached Ethernet0/0
10.0.0.0/32 receive Ethernet0/0
10.0.0.1/32 receive Ethernet0/0
10.0.0.2/32 attached Ethernet0/0
10.0.0.255/32 receive Ethernet0/0
10.0.1.0/24 10.0.0.2 Ethernet0/0
127.0.0.0/8 drop
224.0.0.0/4 drop
224.0.0.0/24 receive 
240.0.0.0/4 drop
255.255.255.255/32 receive 

R1#sh ip route 2.2.2.2

Routing entry for 2.2.2.2/32
 Known via "ospf 1", distance 110, metric 11, type intra area
 Last update from 10.0.0.2 on Ethernet0/0, 00:30:34 ago
 Routing Descriptor Blocks:
 * 10.0.0.2, from 2.2.2.2, 00:30:34 ago, via Ethernet0/0
 Route metric is 11, traffic share count is 1 
 
R1#sh ip route 3.3.3.3

Routing entry for 3.3.3.3/32
 Known via "ospf 1", distance 110, metric 21, type intra area
 Last update from 10.0.0.2 on Ethernet0/0, 00:11:43 ago
 Routing Descriptor Blocks:
 * 10.0.0.2, from 3.3.3.3, 00:11:43 ago, via Ethernet0/0
 Route metric is 21, traffic share count is 1

R1#sh ip cef 2.2.2.2

2.2.2.2/32
 nexthop 10.0.0.2 Ethernet0/0
R1#sh ip cef 3.3.3.3
3.3.3.3/32
 nexthop 10.0.0.2 Ethernet0/0

R1(config)#mpls label range 100 199
R1(config)#mpls label protocol ldp
R1(config)#mpls ldp router-id loopback 0
R1(config)#int e0/0
R1(config-if)#mpls ip

R1#sh mpls interfaces

Interface IP Tunnel BGP Static Operational
Ethernet0/0 Yes (ldp) No No No Yes 

R1#sh mpls ldp neighbor 

 Peer LDP Ident: 2.2.2.2:0; Local LDP Ident 1.1.1.1:0
 TCP connection: 2.2.2.2.27963 - 1.1.1.1.646
 State: Oper; Msgs sent/rcvd: 13/14; Downstream
 Up time: 00:05:21
 LDP discovery sources:
 Ethernet0/0, Src IP addr: 10.0.0.2
 Addresses bound to peer LDP Ident:
 10.0.0.2 10.0.1.2 2.2.2.2 
 
R1#sh ip cef 3.3.3.3

3.3.3.3/32
 nexthop 10.0.0.2 Ethernet0/0 label 201

R1#sh ip cef 2.2.2.2

2.2.2.2/32
 nexthop 10.0.0.2 Ethernet0/0

R1#sh mpls forwarding-table 

Local Outgoing Prefix Bytes Label Outgoing Next Hop 
Label Label or Tunnel Id Switched interface 
100 Pop Label 2.2.2.2/32 0 Et0/0 10.0.0.2 
101 201 3.3.3.3/32 0 Et0/0 10.0.0.2 
102 Pop Label 10.0.1.0/24 0 Et0/0 10.0.0.2 

R1#sh mpls ldp bindings 

 lib entry: 1.1.1.1/32, rev 2
 local binding: label: imp-null
 remote binding: lsr: 2.2.2.2:0, label: 200
 lib entry: 2.2.2.2/32, rev 4
 local binding: label: 100
 remote binding: lsr: 2.2.2.2:0, label: imp-null
 lib entry: 3.3.3.3/32, rev 6
 local binding: label: 101
 remote binding: lsr: 2.2.2.2:0, label: 201
 lib entry: 10.0.0.0/24, rev 8
 local binding: label: imp-null
 remote binding: lsr: 2.2.2.2:0, label: imp-null
 lib entry: 10.0.1.0/24, rev 10
 local binding: label: 102
 remote binding: lsr: 2.2.2.2:0, label: imp-null

R1#ping 3.3.3.3 source 10.0.0.1

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 3.3.3.3, timeout is 2 seconds:
Packet sent with a source address of 10.0.0.1 
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/2 ms

R1#traceroute 3.3.3.3 source 10.0.0.1

Type escape sequence to abort.
Tracing the route to 3.3.3.3
VRF info: (vrf in name/id, vrf out name/id)
 1 10.0.0.2 [MPLS: Label 201 Exp 0] 1 msec 1 msec 0 msec
 2 10.0.1.3 1 msec 2 msec * 

R1#ping 2.2.2.2 source 10.0.0.1 

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 2.2.2.2, timeout is 2 seconds:
Packet sent with a source address of 10.0.0.1 
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 5/5/6 ms

R1#traceroute 2.2.2.2 source 10.0.0.1

Type escape sequence to abort.
Tracing the route to 2.2.2.2
VRF info: (vrf in name/id, vrf out name/id)
 1 10.0.0.2 2 msec 1 msec *


