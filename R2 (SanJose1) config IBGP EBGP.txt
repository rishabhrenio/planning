R2 (SanJose1)

Router>enable
Router#conf t
Router(config)#hostname SanJose1
SanJose1(config)#interface Loopback0
SanJose1(config-if)#ip address 172.16.64.1 255.255.255.0
SanJose1(config-if)#ip address 172.16.64.1 255.255.255.0
SanJose1(config-if)#exit

SanJose1(config)#interface Serial1/0
SanJose1(config-if)#ip address 192.168.1.6 255.255.255.252
SanJose1(config-if)#no shutdown
SanJose1(config-if)#exit

SanJose1(config)#interface Serial1/1
SanJose1(config-if)#ip address 172.16.1.1 255.255.255.0
SanJose1(config-if)#no shutdown
SanJose1(config-if)#exit

SanJose1(config)#router eigrp 64512

SanJose1(config-router)#network 172.16.0.0
SanJose1(config-router)#no auto-summary
SanJose1(config-router)#exit

SanJose1(config)#router bgp 64512

SanJose1(config-router)#neighbor 172.16.32.1 remote-as 64512
SanJose1(config-router)#neighbor 172.16.32.1 update-source loopback0
SanJose1(config-router)#exit

SanJose1(config)#ip route 172.16.0.0 255.255.0.0 null 0
SanJose1(config)#router bgp 64512

SanJose1(config-router)#network 172.16.0.0
SanJose1(config-router)#neighbor 192.168.1.5 remote-as 200
SanJose1(config-router)#exit

SanJose1(config)#router bgp 64512

SanJose1(config-router)#neighbor 172.16.32.1 next-hop-self
SanJose1(config-router)#exit

SanJose1#sh ip bgp

BGP table version is 5, local router ID is 172.16.64.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.32.1 0 100 0 i
*> 0.0.0.0 0 32768 i
* i 192.168.1.0/30 172.16.32.1 0 100 0 200 i
*> 192.168.1.5 0 0 200 i
r i 192.168.1.4/30 172.16.32.1 0 100 0 200 i
r> 192.168.1.5 0 0 200 i
* i 192.168.100.0 172.16.32.1 0 100 0 200 i
*> 192.168.1.5 0 0 200 i

SanJose1#conf t
SanJose1(config)#route-map PRIMARY_T1_IN permit 10

SanJose1(config-route-map)#set local-preference 160
SanJose1(config-route-map)#exit

SanJose1(config)#router bgp 64512

SanJose1(config-router)#neighbor 192.168.1.5 route-map PRIMARY_T1_IN in
SanJose1(config-router)#exit

SanJose1#clear ip bgp * soft

SanJose1#sh ip bgp

BGP table version is 8, local router ID is 172.16.64.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.32.1 0 100 0 i
*> 0.0.0.0 0 32768 i
*> 192.168.1.0/30 192.168.1.5 0 160 0 200 i
r> 192.168.1.4/30 192.168.1.5 0 160 0 200 i
*> 192.168.100.0 192.168.1.5 0 160 0 200 i

SanJose1(config)#route-map PRIMARY_T1_MED_OUT permit 10

SanJose1(config-route-map)#set Metric 50
SanJose1(config-route-map)#exit

SanJose1(config)#router bgp 64512

SanJose1(config-router)#neighbor 192.168.1.5 route-map PRIMARY_T1_MED_OUT out
SanJose1(config-router)#exit

SanJose1(config)#exit

SanJose1#clear ip bgp * soft

SanJose1#sh ip bgp

BGP table version is 8, local router ID is 172.16.64.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.32.1 0 100 0 i
*> 0.0.0.0 0 32768 i
*> 192.168.1.0/30 192.168.1.5 0 160 0 200 i
r> 192.168.1.4/30 192.168.1.5 0 160 0 200 i
*> 192.168.100.0 192.168.1.5 0 160 0 200 i

SanJose1#sh ip route

Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
 D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
 N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
 E1 - OSPF external type 1, E2 - OSPF external type 2
 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
 ia - IS-IS inter area, * - candidate default, U - per-user static route
 o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
 a - application route
 + - replicated route, % - next hop override
Gateway of last resort is not set
 172.16.0.0/16 is variably subnetted, 6 subnets, 3 masks
S 172.16.0.0/16 is directly connected, Null0
C 172.16.1.0/24 is directly connected, Serial1/1
L 172.16.1.1/32 is directly connected, Serial1/1
D 172.16.32.0/24 [90/2297856] via 172.16.1.2, 01:28:25, Serial1/1
C 172.16.64.0/24 is directly connected, Loopback0
L 172.16.64.1/32 is directly connected, Loopback0
 192.168.1.0/24 is variably subnetted, 3 subnets, 2 masks
B 192.168.1.0/30 [20/0] via 192.168.1.5, 00:45:28
C 192.168.1.4/30 is directly connected, Serial1/0
L 192.168.1.6/32 is directly connected, Serial1/0
B 192.168.100.0/24 [20/0] via 192.168.1.5, 00:45:28
After issuing ip default-network

SanJose1(config)#ip default-network 192.168.100.0
SanJose1(config)#end

SanJose1#sh ip route

Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
 D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
 N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
 E1 - OSPF external type 1, E2 - OSPF external type 2
 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
 ia - IS-IS inter area, * - candidate default, U - per-user static route
 o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
 a - application route
 + - replicated route, % - next hop override
Gateway of last resort is 192.168.1.5 to network 192.168.100.0
S* 0.0.0.0/0 [20/0] via 192.168.1.5
 172.16.0.0/16 is variably subnetted, 6 subnets, 3 masks
S 172.16.0.0/16 is directly connected, Null0
C 172.16.1.0/24 is directly connected, Serial1/1
L 172.16.1.1/32 is directly connected, Serial1/1
D 172.16.32.0/24 [90/2297856] via 172.16.1.2, 01:33:38, Serial1/1
C 172.16.64.0/24 is directly connected, Loopback0
L 172.16.64.1/32 is directly connected, Loopback0
 192.168.1.0/24 is variably subnetted, 3 subnets, 2 masks
B 192.168.1.0/30 [20/0] via 192.168.1.5, 00:50:41
C 192.168.1.4/30 is directly connected, Serial1/0
L 192.168.1.6/32 is directly connected, Serial1/0
B* 192.168.100.0/24 [20/0] via 192.168.1.5, 00:50:41

SanJose1#ping 192.168.1.2

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.1.2, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 14/15/16 ms

SanJose1#traceroute 192.168.1.2

Type escape sequence to abort.
Tracing the route to 192.168.1.2
VRF info: (vrf in name/id, vrf out name/id)
 1 192.168.1.5 [AS 200] 10 msec 10 msec 10 msec
 2 192.168.1.2 [AS 200] 15 msec 15 msec * 

SanJose1#ping 192.168.1.1 

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.1.1, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 9/9/11 ms

SanJose1#traceroute 192.168.1.1

Type escape sequence to abort.
Tracing the route to 192.168.1.1
VRF info: (vrf in name/id, vrf out name/id)
 1 192.168.1.5 [AS 200] 10 msec 11 msec *


