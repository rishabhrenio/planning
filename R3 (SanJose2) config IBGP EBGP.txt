R3 (SanJose2)

Router>enable
Router#conf t
Router(config)#hostname SanJose2
SanJose2(config)#interface Loopback0
SanJose2(config-if)#ip address 172.16.32.1 255.255.255.0
SanJose2(config-if)#exit

SanJose2(config)#interface Serial1/1
SanJose2(config-if)#ip address 192.168.1.2 255.255.255.252
SanJose2(config-if)#no shutdown
SanJose2(config-if)#exit

SanJose2(config)#interface Serial1/0
SanJose2(config-if)#ip address 172.16.1.2 255.255.255.0
SanJose2(config-if)#no shutdown
SanJose2(config-if)#exit

SanJose2(config)#router eigrp 64512

SanJose2(config-router)#network 172.16.0.0
SanJose2(config-router)#no auto-summary
SanJose2(config-router)#exit

SanJose2(config)#router bgp 64512

SanJose2(config-router)#neighbor 172.16.64.1 remote-as 64512
SanJose2(config-router)#neighbor 172.16.64.1 update-source loopback0
SanJose2(config-router)#exit

SanJose2(config)#ip route 172.16.0.0 255.255.0.0 null 0
SanJose2(config)#router bgp 64512

SanJose2(config-router)#network 172.16.0.0
SanJose2(config-router)#neighbor 192.168.1.1 remote-as 200
SanJose2(config-router)#exit

SanJose2#sh ip bgp summary

BGP router identifier 172.16.32.1, local AS number 64512
BGP table version is 4, main routing table version 4
2 network entries using 280 bytes of memory
4 path entries using 320 bytes of memory
4/2 BGP path/bestpath attribute entries using 576 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1200 total bytes of memory
BGP activity 2/0 prefixes, 4/0 paths, scan interval 60 secs
Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down 
State/PfxRcd
172.16.64.1 4 64512 31 32 4 0 0 00:24:41 2
192.168.1.1 4 200 8 6 4 0 0 00:01:22 1

SanJose2#sh ip route

Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
 D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
 N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
 E1 - OSPF external type 1, E2 - OSPF external type 2
 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
 ia - IS-IS inter area, * - candidate default, U - per-user static route
 o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
 a - application route
 + - replicated route, % - next hop override
Gateway of last resort is not set
 172.16.0.0/16 is variably subnetted, 6 subnets, 3 masks
S 172.16.0.0/16 is directly connected, Null0
C 172.16.1.0/24 is directly connected, Serial1/0
L 172.16.1.2/32 is directly connected, Serial1/0
C 172.16.32.0/24 is directly connected, Loopback0
L 172.16.32.1/32 is directly connected, Loopback0
D 172.16.64.0/24 [90/2297856] via 172.16.1.1, 00:08:46, Serial1/0
 192.168.1.0/24 is variably subnetted, 3 subnets, 2 masks
C 192.168.1.0/30 is directly connected, Serial1/1
L 192.168.1.2/32 is directly connected, Serial1/1
B 192.168.1.4/30 [20/0] via 192.168.1.1, 00:02:19
B 192.168.100.0/24 [20/0] via 192.168.1.1, 00:07:40

SanJose2#sh ip bgp

BGP table version is 5, local router ID is 172.16.32.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.64.1 0 100 0 i
*> 0.0.0.0 0 32768 i
r i 192.168.1.0/30 192.168.1.5 0 100 0 200 i
r> 192.168.1.1 0 0 200 i
* i 192.168.1.4/30 192.168.1.5 0 100 0 200 i
*> 192.168.1.1 0 0 200 i
* i 192.168.100.0 192.168.1.5 0 100 0 200 i
*> 192.168.1.1 0 0 200 i

SanJose2(config)#router bgp 64512

SanJose2(config-router)#neighbor 172.16.64.1 next-hop-self
SanJose2(config-router)#exit

SanJose2#sh ip bgp 

BGP table version is 5, local router ID is 172.16.32.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.64.1 0 100 0 i
*> 0.0.0.0 0 32768 i
r i 192.168.1.0/30 172.16.64.1 0 100 0 200 i
r> 192.168.1.1 0 0 200 i
* i 192.168.1.4/30 172.16.64.1 0 100 0 200 i
*> 192.168.1.1 0 0 200 i
* i 192.168.100.0 172.16.64.1 0 100 0 200 i
*> 192.168.1.1 0 0 200 i

SanJose2(config)#route-map SECONDARY_T1_IN permit 10

SanJose2(config-route-map)#set local-preference 125
SanJose2(config-route-map)#exit

SanJose2(config)#router bgp 64512

SanJose2(config-router)#neighbor 192.168.1.1 route-map SECONDARY_T1_IN in
SanJose2(config-router)#exit

SanJose2#clear ip bgp * soft

SanJose2#sh ip bgp

BGP table version is 8, local router ID is 172.16.32.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.64.1 0 100 0 i
*> 0.0.0.0 0 32768 i
r>i 192.168.1.0/30 172.16.64.1 0 160 0 200 i
r 192.168.1.1 0 125 0 200 i
*>i 192.168.1.4/30 172.16.64.1 0 160 0 200 i
* 192.168.1.1 0 125 0 200 i
*>i 192.168.100.0 172.16.64.1 0 160 0 200 i
* 192.168.1.1 0 125 0 200 i

SanJose2(config)#route-map SECONDARY_T1_MED_OUT permit 10

SanJose2(config-route-map)#set Metric 75
SanJose2(config-route-map)#exit

SanJose2(config)#router bgp 64512

SanJose2(config-router)#$2.168.1.1 route-map SECONDARY_T1_MED_OUT out 
SanJose2(config-router)#end

SanJose2#clear ip bgp * soft

SanJose2#sh ip bgp

BGP table version is 8, local router ID is 172.16.32.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, 
 r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
 x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found
 Network Next Hop Metric LocPrf Weight Path
* i 172.16.0.0 172.16.64.1 0 100 0 i
*> 0.0.0.0 0 32768 i
r>i 192.168.1.0/30 172.16.64.1 0 160 0 200 i
r 192.168.1.1 0 125 0 200 i
*>i 192.168.1.4/30 172.16.64.1 0 160 0 200 i
* 192.168.1.1 0 125 0 200 i
*>i 192.168.100.0 172.16.64.1 0 160 0 200 i
* 192.168.1.1 0 125 0 200 i



